image: ubuntu:19.10

stages:
  - build
  - post

build:debian:package:
  stage: build
  only:
    - /^release/.*$/
  script:
    - apt update
    - apt install -y build-essential autoconf automake autotools-dev dh-make debhelper devscripts fakeroot xutils lintian pbuilder
    - cd live-light-server
    - debuild -i -us -uc -b
    - cd ../live-light-client
    - debuild -i -us -uc -b
    - cd ..
  artifacts:
    paths:
      - "*.deb"

create:gitlab:release:
  image: registry.gitlab.com/gitlab-automation-toolkit/gitlab-auto-release
  stage: post
  only:
    - /^release/.*$/
  script:
    - gitlab_auto_release -c CHANGELOG.md -d "This was auto-generated by the gitlab-auto-release tool, https://gitlab.com/gitlab-automation-toolkit/gitlab-auto-release." --artifacts "build:debian:package"
